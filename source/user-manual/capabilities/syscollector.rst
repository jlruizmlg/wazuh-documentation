.. Copyright (C) 2018 Wazuh, Inc.

.. _syscollector:

System inventory
================

The Wazuh agents are able to collect interesting system information and store it into a DB for each agent on the manager side. The `Syscollector` module is in charge of this collection.

- `Available scans`_
    - Hardware
    - Operating System
    - Network interfaces
    - Packages
    - Ports
    - Processes
- `Compatibility matrix`_
- `How it works`_
- `Use case: Visualize system inventory in the Wazuh App`_

Available scans
---------------

The collected information from Wazuh agents are stored in different SQLite tables. Here is described the content of each available table.

Hardware
^^^^^^^^

 Retrieve basic information about the hardware components of a system.

+------------------+---------------------+-------------------------------------------+-------------------+
| Field            | Description         | Example                                   | Available         |
+==================+=====================+===========================================+===================+
| **scan_id**      | Scan identifier     | 573872577                                 | Linux and Windows |
+------------------+---------------------+-------------------------------------------+-------------------+
| **scan_time**    | Scan date           | 2018/07/31 15:31:26                       | Linux and Windows |
+------------------+---------------------+-------------------------------------------+-------------------+
| **board_serial** | Serial number       | NKP670HSGM07E00474                        | Linux and Windows |
+------------------+---------------------+-------------------------------------------+-------------------+
| **cpu_name**     | Cpu name            | Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz | Linux and Windows |
+------------------+---------------------+-------------------------------------------+-------------------+
| **cpu_cores**    | Number of cpu's     | 4                                         | Linux and Windows |
+------------------+---------------------+-------------------------------------------+-------------------+
| **cpu_mhz**      | Processor frequency | 900.106                                   | Linux and Windows |
+------------------+---------------------+-------------------------------------------+-------------------+
| **ram_total**    | Total RAM           | 16374572                                  | Linux and Windows |
+------------------+---------------------+-------------------------------------------+-------------------+
| **ram_free**     | Free RAM            | 2111928                                   | Linux and Windows |
+------------------+---------------------+-------------------------------------------+-------------------+

 - `Operating system`

 Retrieve basic information about the Operating System.

+------------------+-------------------------+-----------------------------------------------------+-------------------+
| Field            | Description             | Example                                             | Available         |
+==================+=========================+=====================================================+===================+
| **scan_id**      | Scan identifier         | 468455719                                           | Linux and Windows |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **scan_time**    | Scan date               | 2018/07/31 15:31:26                                 | Linux and Windows |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **hostname**     | Network hostname        | wazuh-manager                                       | Linux and Windows |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **architecture** | OS arquitecture         | x86_64                                              | Linux and Windows |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **os_name**      | OS name                 | Ubuntu                                              | Linux and Windows |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **os_version**   | OS version              | 16.04.5 LTS (Xenial Xerus)                          | Linux and Windows |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **os_codename**  | OS version codename     | Xenial Xerus                                        | Linux and Windows |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **os_major**     | Major release version   | 16                                                  | Linux and Windows |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **os_minor**     | Minor release version   | 04                                                  | Linux and Windows |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **os_build**     | Optional build-specific |                                                     | Linux and Windows |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **os_platform**  | OS platform             | ubuntu                                              | Linux and Windows |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **sysname**      | System name             | Linux                                               | Linux and Windows |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **release**      | Release name            | 4.15.0-29-generic                                   | Linux and Windows |
+------------------+-------------------------+-----------------------------------------------------+-------------------+
| **version**      | Release version name    | #31~16.04.1-Ubuntu SMP Wed Jul 18 08:54:04 UTC 2018 | Linux and Windows |
+------------------+-------------------------+-----------------------------------------------------+-------------------+


 - `Network`

 Retrieve information about the existing network interface of a system (up and down interfaces) as well as their routing configuration.

+------------------+---------------------------+-----------------------------------------------------+-------------------+
| Field            | Description               | Example                                             | Available         |
+==================+===========================+=====================================================+===================+
| **id**           | Id                        | 1                                                   | Linux and Windows |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **scan_id**      | Scan identifier           | 160615720                                           | Linux and Windows |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **scan_time**    | Scan date                 | 2018/07/31 16:46:20                                 | Linux and Windows |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **name**         | Interface name            | eth0                                                | Linux and Windows |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **adapter**      | Physical adapter name     | Intel(R) PRO/1000 MT Desktop Adapter                | Windows           |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **type**         | Network adapter           | ethernet                                            | Linux and Windows |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **state**        | State of network          | up                                                  | Linux and Windows |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **mtu**          | Maximum transmission unit | 1500                                                | Linux and Windows |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **mac**          | MAC Address               | 08:00:27:C0:14:A5                                   | Linux and Windows |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **tx_packets**   | Transmitted packets       | 30279                                               | Linux and Windows |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **rx_packets**   | Received packets          | 12754                                               | Linux and Windows |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **tx_bytes**     | Transmitted bytes         | 10034626                                            | Linux and Windows |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **rx_bytes**     | Received bytes            | 1111175                                             | Linux and Windows |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **tx_errors**    | Transmitted with error    | 0                                                   | Linux and Windows |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **rx_errors**    | Received with error       | 0                                                   | Linux and Windows |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **tx_dropped**   | Transmitted and discarded | 0                                                   | Linux and Windows |
+------------------+---------------------------+-----------------------------------------------------+-------------------+
| **rx_dropped**   | Received and discarded    | 0                                                   | Linux and Windows |
+------------------+---------------------------+-----------------------------------------------------+-------------------+


+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| Field            | Description                     | Example                                             | Available         |
+==================+=================================+=====================================================+===================+
| **id**           | Referenced id from sys_netiface | 468455719                                           | Linux and Windows |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **scan_id**      | Scan identifier                 | 160615720                                           | Linux and Windows |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **proto**        | Protocol name                   | ipv4                                                | Linux and Windows |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **address**      | IP(v4/v6) address               | 192.168.1.87                                        | Linux and Windows |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **netmask**      | Mask address                    | 255.255.255.0                                       | Linux and Windows |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+
| **broadcast**    | Broadcast address               | 192.168.1.255                                       | Linux and Windows |
+------------------+---------------------------------+-----------------------------------------------------+-------------------+

+------------------+---------------------------------+-----------------------+-------------------+
| Field            | Description                     | Example               | Available         |
+==================+=================================+=======================+===================+
| **id**           | Referenced id from sys_netiface | 1                     | Linux and Windows |
+------------------+---------------------------------+-----------------------+-------------------+
| **scan_id**      | Scan identifier                 | 160615720             | Linux and Windows |
+------------------+---------------------------------+-----------------------+-------------------+
| **iface**        | Network adapter name            | eth0                  | Linux and Windows |
+------------------+---------------------------------+-----------------------+-------------------+
| **type**         | Protocol name                   | Ubuntu                | Linux and Windows |
+------------------+---------------------------------+-----------------------+-------------------+
| **gateway**      | Gateway address                 | 192.168.1.1           | Linux and Windows |
+------------------+---------------------------------+-----------------------+-------------------+
| **dhcp**         | dhcp configuration              | enabled               | Linux and Windows |
+------------------+---------------------------------+-----------------------+-------------------+



- `Packages`

 The currently packages inventory of each Wazuh agent. On Linux systems, retrieved packages can be `deb` or `rpm` types.

+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| Field            | Description                            | Example                                           | Available         |
+==================+========================================+===================================================+===================+
| **scan_id**      | Scan identifier                        | 1454946158                                        | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **scan_time**    | Scan date                              | 2018/07/27 07:27:14                               | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **format**       | Format of the package                  | deb                                               | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **name**         | Name of the package                    | linux-headers-generic                             | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **priority**     | Priority of the package                | optional                                          | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **section**      | Section of the package                 | kernel                                            | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **size**         | Size of the installed package in bytes | 14                                                | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **vendor**       | Vendor name                            | Ubuntu Kernel Team <kernel-team@lists.ubuntu.com> | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **install_time** | Time to install the package            |                                                   | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **version**      | Version of the package                 | 4.4.0.130.136                                     | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **architecture** | Architecture of the package            | amd64                                             | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **multiarch**    |                                        |                                                   | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **source**       | Source of the package                  | linux-meta                                        | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **description**  | Description of the package             | Generic Linux kernel headers                      | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **location**     | Location of the package                |                                                   | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **triaged**      |                                        | 0                                                 | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+


 - `Ports`

 List of the opened ports of a system.

+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| Field            | Description                            | Example                                           | Available         |
+==================+========================================+===================================================+===================+
| **scan_id**      | Scan identifier                        | 1618114744                                        | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **scan_time**    | Scan date                              | 2018/07/27 07:27:15                               | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **protocol**     | Protocol of the port                   | tcp                                               | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **local_ip**     | Local ip                               | 0.0.0.0                                           | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **local_port**   | Local port                             | 22                                                | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **remote_ip**    | Remote ip                              | 0.0.0.0                                           | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **remote_port**  | Remote port                            | 0                                                 | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **tx_queue**     |                                        | 0                                                 | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **rx_queue**     |                                        | 0                                                 | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **inode**        | Inode of the port                      | 16974                                             | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **state**        | State of the port                      | listening                                         | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **PID**          |                                        |                                                   | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+
| **process**      |                                        | linux-meta                                        | Linux and Windows |
+------------------+----------------------------------------+---------------------------------------------------+-------------------+


 - `Processes`

 List of the current processes running in a system host.

+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| Field           | Description                            | Example                                           | Available         |
+=================+========================================+===================================================+===================+
| **scan_id**     | Scan identifier                        | 2147483647                                        | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **scan_time**   | Scan date                              | 2018/07/27 07:27:15                               | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **pid**         | PID of the process                     | 1238                                              | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **name**        | Name of the process                    | tail                                              | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **state**       | State of the process                   | S                                                 | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **ppid**        | PPID of the process                    | 2041                                              | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **utime**       | Time spent executing user code         | 0                                                 | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **stime**       | Time spent executing system code       | 13                                                | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **cmd**         | Comand executed                        | tail                                              | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **argvs**       | Arguments of the process               | -Fn1000,/var/ossec/logs/alerts/alerts.log         | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **euser**       | Effective user                         | root                                              | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **ruser**       | Real user                              | root                                              | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **suser**       | Saved-set user                         | root                                              | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **egroup**      | Effective group                        | root                                              | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **rgroup**      | Real group                             | root                                              | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **sgroup**      | Saved-set group                        | root                                              | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **fgroup**      |                                        | root                                              | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **nice**        | Nice value of the process              | 20                                                | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **size**        | Size of the process                    | 0                                                 | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **vm_size**     | Total VM size in kB                    | 1510                                              | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **resident**    | Residen size of the process in bytes   | 6040                                              | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **share**       |                                        | 178                                               | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **start_time**  | Time when the process started          | 161                                               | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **pgrp**        | Process group                          | 120075                                            | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **session**     | Session of the process                 | 2492                                              | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **nlwp**        | Number of light weight processes       | 1925                                              | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **tgid**        | Thread Group ID                        | 1                                                 | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **tty**         | Number of TTY of the process           | 34817                                             | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+
| **processor**   | Number of the processor                | 0                                                 | Linux and Windows |
+-----------------+----------------------------------------+---------------------------------------------------+-------------------+



Compatibility matrix
---------------------

The following table shows the compatibility matrix shows the scans compatibility for the different available operating systems:

+------------------------+----------------------------------------------------------------------+
|                        |                      **Syscollector scan**                           |
+  **Operating System**  +-----------+-----------+-----------+----------+-----------+-----------+
|                        |  Hardware |    OS     |  Packages |  Network |   Ports   | Processes |
+------------------------+-----------+-----------+-----------+----------+-----------+-----------+
|    Windows             |     ✓     |     ✓     |     ✓     |     ✓    |     ✓     |     ✓     |
+------------------------+-----------+-----------+-----------+----------+-----------+-----------+
|    Linux               |     ✓     |     ✓     |     ✓     |     ✓    |     ✓     |     ✓     |
+------------------------+-----------+-----------+-----------+----------+-----------+-----------+
|    macOS               |     ✓     |     ✗     |     ✓     |     ✗    |     ✓     |     ✗     |
+------------------------+-----------+-----------+-----------+----------+-----------+-----------+
|    FreeBSD             |     ✓     |     ✗     |     ✓     |     ✗    |     ✓     |     ✗     |
+------------------------+-----------+-----------+-----------+----------+-----------+-----------+
|    OpenBSD             |     ✓     |     ✗     |     ✗     |     ✗    |     ✓     |     ✗     |
+------------------------+-----------+-----------+-----------+----------+-----------+-----------+



How it works
-------------



Use case: Visualize system inventory in the Wazuh App
-----------------------------------------------------



.. thumbnail:: ../../images/manual/syscollector-scan.png
    :title: Syscollector scan
    :align: center
    :width: 100%
